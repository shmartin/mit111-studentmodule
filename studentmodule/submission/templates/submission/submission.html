{% extends 'layout.html' %}

{% block title %}
  Submission
{% endblock %}

{% load static %}

{% block style %}
<link rel="stylesheet" href="{% static 'css/submission.css' %}">
{% endblock %}

{% block content %}
    <header>
        <div class="logo-container">
        <image src="../../static/images/SAS Logo.png" alt="Institution Logo" class="logo" />
        <div class="institution-name">
          <span>SCHOOL OF ADVANCED STUDIES</span>
          <span class="university-name">Saint Louis University, Baguio City</span>
        </div>
        </div>
        <nav>
           <a href="{% url 'submission' %}">Home</a>
           <a href="{% url 'guidelines' %}">Guidelines</a>
           <a href="#">Help</a>
        </nav>
    </header>
    <div class="container">
      
      {% if messages %}
      <ul class="messages">
        {% for messages in messages %}
          <li class="{{ message.tags }}">{{ message }}</li>li>
        {% endfor %}
      </ul>
      {% endif %}
    
      <div class="notifications">
      <h3>üîî Recent Notifications</h3>
      <ul>
        {% for i in doc_eval %}
          {% if i.status == 'Under Review'%}
            <li>üì¨ <span class="badge under-review">Feedback</span> available for "{{ i.did.dtitle }}"</li>
          {% elif i.status == 'Revision Required' %}
            <li>üì¢ <span class="badge revision">Revisions</span> requested for "{{ i.did.dtitle }}"</li>
          {% elif i.status == 'Accepted' %}
            <li>‚úÖ "{{ i.did.dtitle }}" has been <span class="badge accepted">accepted</span></li>
          {% endif %}
        {% endfor %}
      </ul>
    </div>
    <div class="welcome">
      <h2>üëã Welcome, <span id="studentName">{{ request.user }}</span>!</h2>
    </div>
    <form method="POST" enctype="multipart/form-data">
      {% csrf_token %}
      <div class="actions">
        <button type="button">Submit a New Research Paper</button>
        <button type="button">View Submission History</button>
      </div>
      
      <div class="panel">
        <h3>üìù Submit a New Research Paper</h3>
        <div class="form-group">
          <label>Title:</label>
          <input type="text" name="title" required>
      </div>
      <div class="form-group">
          <label>Abstract:</label>
          <textarea rows="4" name="abstract" required></textarea>
      </div>
          <div class="form-group">
          <label>Authors' Names:</label>
          <input type="text" name="authors" required>
      </div>
          <div class="form-group">
          <label>Adviser:</label>
          <input type="text" name="adviser" required>
      </div>
      <div class="form-group">
          <label>Category/Field of Study:</label>
          <select name="category" required>
            <option>Computer Science</option>
            <option>Engineering</option>
            <option>Social Sciences</option>
            <!-- more categories -->
          </select>
      </div>
      <div class="form-group">
          <label>Upload File (PDF/DOC/DOCX):</label>
          <input type="file" name="paper_file" id="paper_file" accept=".pdf,.doc,.docx" required>
          <small id="fileError" style="color: red; display: none;">Invalid file. Only PDF, DOC, or DOCX under 20MB allowed.</small>
      </div>
      <button type="submit" class="action-btn">Submit Research Paper</button>
      </div>
    </form>
    <div class="status">
      <h3>üìä My Submissions</h3>
      <table>
        <thead>
          <tr>
            <th>Paper Title</th>
            <th>Status</th>
            <th>Last Updated</th>
            <th>Action</th>
          </tr>
        </thead>
    <tbody>
          {% for i in doc_eval %}
            <tr>
              <td>{{ i.did.dtitle }}</td>
              {% if i.status == 'Under Review'%}
                <td><span class="badge under-review">Under Review</span></td>
                <td>{{ i.updated_at }}</td>
                <td><button class="badge under-review">View</button></td>
              {% elif i.status == 'Revision Required' %}
                <td><span class="badge revision">Revision Required</span></td>
                <td>{{ i.updated_at }}</td>
                <td><button class="badge revision">Resubmit</button></td>
              {% elif i.status == 'Accepted' %}
                <td><span class="badge accepted">Accepted</span></td>
                <td>{{ i.updated_at }}</td>
                <td><button class="badge accepted">Download</button></td>
              {% endif %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
<script>
document.getElementById("paper_file").addEventListener("change", function () {
    const file = this.files[0];
    const allowedTypes = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
    const maxSize = 20 * 1024 * 1024; // 20MB

    const fileError = document.getElementById("fileError");
    if (file && (!allowedTypes.includes(file.type) || file.size > maxSize)) {
        fileError.style.display = "block";
        this.value = ""; // Reset file input
    } else {
        fileError.style.display = "none";
    }
});
</script>
{% endblock %}
